{
  "info": {
    "_postman_id": "rateit-user-collection",
    "name": "Rate It - User APIs",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
    "description": "Official Postman collection for Rate It - USER APIs. Includes Onboarding and Auth endpoints."
  },
  "variable": [
    { "key": "base_url", "value": "http://127.0.0.1:8000" },
    { "key": "api_version", "value": "v1" },
    { "key": "user_token", "value": "" },
    { "key": "reset_token", "value": "" },
    { "key": "phone", "value": "+201000000000" },
    { "key": "otp", "value": "" }
  ],
  "event": [
    {
      "listen": "prerequest",
      "script": {
          "exec": [
          "// Ensure base_url is configured in environment or collection variables",
          "if (!pm.variables.get('base_url')) {",
          "  throw new Error('base_url is not set in environment or collection variables. Set {{base_url}} to continue.');",
          "}",
          "// Ensure default headers exist for each request: Accept and X-Lang (don't overwrite explicit headers)",
          "function ensureHeaderIfMissing(key, value){",
          "  if (!pm.request.headers.get(key)) {",
          "    pm.request.headers.add({ key: key, value: value });",
          "  }",
          "}",
          "ensureHeaderIfMissing('Accept','application/json');",
          "ensureHeaderIfMissing('X-Lang','en');",
          "// For POST/PUT/PATCH ensure Content-Type if absent",
          "if (pm.request.method === 'POST' || pm.request.method === 'PUT' || pm.request.method === 'PATCH') {",
          "  ensureHeaderIfMissing('Content-Type','application/json');",
          "}"
        ],
        "type": "text/javascript"
      }
    }
  ],
  "item": [
            {
              "name": "GET Home Banners",
              "request": {
                "method": "GET",
                "header": [
                  { "key": "Accept", "value": "application/json" },
                  { "key": "X-Lang", "value": "en" }
                ],
                "url": {
                  "raw": "{{base_url}}/api/{{api_version}}/user/home/banners",
                  "host": ["{{base_url}}"],
                  "path": ["api","{{api_version}}","user","home","banners"]
                }
              },
              "response": [],
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test('status is 200', function(){ pm.response.to.have.status(200); });",
                      "var json = pm.response.json();",
                      "pm.test('success true', function(){ pm.expect(json.success).to.eql(true); });",
                      "pm.test('data is array', function(){ pm.expect(json.data).to.be.an('array'); });",
                      "pm.test('items structure', function(){",
                      "  json.data.forEach(function(item){ pm.expect(item).to.have.property('id'); pm.expect(item).to.have.property('title'); pm.expect(item).to.have.property('image_url'); pm.expect(item).to.have.property('action'); pm.expect(item.action).to.have.property('type'); pm.expect(item.action).to.have.property('value'); });",
                      "});"
                    ],
                    "type": "text/javascript"
                  }
                }
              ]
            },
            {
              "name": "GET Home Categories",
              "request": {
                "method": "GET",
                "header": [
                  { "key": "Accept", "value": "application/json" },
                  { "key": "X-Lang", "value": "en" }
                ],
                "url": {
                  "raw": "{{base_url}}/api/{{api_version}}/user/home/categories",
                  "host": ["{{base_url}}"],
                  "path": ["api","{{api_version}}","user","home","categories"]
                }
              },
              "response": [],
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test('status is 200', function(){ pm.response.to.have.status(200); });",
                      "var json = pm.response.json();",
                      "pm.test('success true', function(){ pm.expect(json.success).to.eql(true); });",
                      "pm.test('data is array', function(){ pm.expect(json.data).to.be.an('array'); });",
                      "pm.test('items structure', function(){",
                      "  json.data.forEach(function(item){ pm.expect(item).to.have.property('id'); pm.expect(item).to.have.property('name'); pm.expect(item).to.have.property('logo_url'); });",
                      "});"
                    ],
                    "type": "text/javascript"
                  }
                }
              ]
            },
    {
      "name": "User - Onboarding",
      "description": "Public endpoints for onboarding screens.",
      "item": [
        {
          "name": "GET Onboarding Screens",
          "request": {
            "method": "GET",
            "header": [
              { "key": "Accept", "value": "application/json" },
              { "key": "X-Lang", "value": "en" }
            ],
            "url": {
              "raw": "{{base_url}}/api/{{api_version}}/user/onboarding-screens",
              "host": ["{{base_url}}"],
              "path": ["api","{{api_version}}","user","onboarding-screens"]
            }
          },
          "response": [
            {
              "name": "Success 200",
              "originalRequest": {},
              "status": "OK",
              "code": 200,
              "body": "{\n  \"success\": true,\n  \"message\": \"Onboarding screens\",\n  \"data\": [ { \"id\":1,\"title\":\"Welcome\" } ],\n  \"meta\": null\n}"
            },
            {
              "name": "Error 500",
              "originalRequest": {},
              "status": "Internal Server Error",
              "code": 500,
              "body": "{\n  \"success\": false,\n  \"message\": \"Server error\",\n  \"data\": null,\n  \"meta\": null\n}"
            }
          ],
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('status is 200', function(){ pm.response.to.have.status(200); });",
                  "var json = pm.response.json();",
                  "pm.test('success true', function(){ pm.expect(json.success).to.eql(true); });",
                  "pm.test('data array <=3', function(){ pm.expect(json.data).to.be.an('array'); pm.expect(json.data.length).to.be.at.most(3); });"
                ],
                "type": "text/javascript"
              }
            }
          ]
        }
      ]
    },
    {
      "name": "User - Lookups",
      "description": "Public lookup endpoints (genders, nationalities)",
      "item": [
        {
          "name": "GET Genders",
          "request": {
            "method": "GET",
            "header": [
              { "key": "Accept", "value": "application/json" },
              { "key": "X-Lang", "value": "en" }
            ],
            "url": {
              "raw": "{{base_url}}/api/{{api_version}}/user/lookups/genders",
              "host": ["{{base_url}}"],
              "path": ["api","{{api_version}}","user","lookups","genders"]
            }
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('status is 200', function(){ pm.response.to.have.status(200); });",
                  "var json = pm.response.json();",
                  "pm.test('success true', function(){ pm.expect(json.success).to.eql(true); });",
                  "pm.test('data is array', function(){ pm.expect(json.data).to.be.an('array'); });",
                  "pm.test('items contain code and name', function(){",
                  "  pm.expect(json.data.length).to.be.at.least(1);",
                  "  json.data.forEach(function(item){ pm.expect(item.id).to.be.a('number'); pm.expect(item.code).to.be.a('string'); pm.expect(item.name).to.be.a('string'); });",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "GET Nationalities",
          "request": {
            "method": "GET",
            "header": [
              { "key": "Accept", "value": "application/json" },
              { "key": "X-Lang", "value": "en" }
            ],
            "url": {
              "raw": "{{base_url}}/api/{{api_version}}/user/lookups/nationalities",
              "host": ["{{base_url}}"],
              "path": ["api","{{api_version}}","user","lookups","nationalities"]
            }
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('status is 200', function(){ pm.response.to.have.status(200); });",
                  "var json = pm.response.json();",
                  "pm.test('success true', function(){ pm.expect(json.success).to.eql(true); });",
                  "pm.test('data is array', function(){ pm.expect(json.data).to.be.an('array'); });",
                  "pm.test('items contain flag_url', function(){",
                  "  pm.expect(json.data.length).to.be.at.least(1);",
                  "  json.data.forEach(function(item){ pm.expect(item.flag_url).to.be.a('string'); pm.expect(item.country_code).to.match(/^[A-Z]{2}$/); pm.test('flag url starts with flagsapi', function(){ pm.expect(item.flag_url.startsWith('https://flagsapi.com/')).to.eql(true); }); });",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ]
        }
      ]
    },
    {
      "name": "User - Auth",
      "description": "Authentication endpoints (register/login/public + protected endpoints in subfolder).",
      "item": [
        {
          "name": "Public",
          "description": "Public auth endpoints: register, login, forgot-password flows.",
          "item": [
            {
              "name": "Register",
              "request": {
                "method": "POST",
                "header": [
                  { "key": "Accept", "value": "application/json" },
                  { "key": "X-Lang", "value": "en" },
                  { "key": "Content-Type", "value": "application/json" }
                ],
                "body": {
                  "mode": "raw",
                  "raw": "{\n  \"full_name\": \"Test User\",\n  \"phone\": \"+201000000000\",\n  \"email\": \"{{test_email}}\",\n  \"birth_date\": \"1990-01-01\",\n  \"gender_id\": 1,\n  \"nationality_id\": 1,\n  \"password\": \"Password123!\",\n  \"password_confirmation\": \"Password123!\"\n}"
                },
                "url": {
                  "raw": "{{base_url}}/api/{{api_version}}/user/auth/register",
                  "host": ["{{base_url}}"],
                  "path": ["api","{{api_version}}","user","auth","register"]
                }
              },
              "response": [
                { "name": "Success 200", "status": "OK", "code": 200, "body": "{ \"success\": true, \"data\": { \"token\": \"abc...\" } }" },
                { "name": "Validation 422", "status": "Unprocessable Entity", "code": 422, "body": "{ \"success\": false, \"data\": { \"phone\": [\"The phone field is required.\"] } }" }
              ],
              "event": [
                {
                  "listen": "prerequest",
                  "script": {
                    "exec": [
                      "// Generate a unique test email for register to avoid duplicate email errors",
                      "var now = Date.now();",
                      "var email = 'test+' + now + '@example.com';",
                      "pm.environment.set('test_email', email);"
                    ],
                    "type": "text/javascript"
                  }
                },
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test('status is 200', function(){ pm.response.to.have.status(200); });",
                      "var json = pm.response.json();",
                      "pm.test('success true', function(){ pm.expect(json.success).to.eql(true); });",
                      "if (json.data && json.data.token) { pm.environment.set('user_token', json.data.token); }"
                    ],
                    "type": "text/javascript"
                  }
                }
              ]
            },
            {
              "name": "Login",
              "request": {
                "method": "POST",
                "header": [
                  { "key": "Accept", "value": "application/json" },
                  { "key": "X-Lang", "value": "en" },
                  { "key": "Content-Type", "value": "application/json" }
                ],
                "body": { "mode": "raw", "raw": "{\n  \"phone\": \"+201000000000\",\n  \"password\": \"Password123!\"\n}" },
                "url": {
                  "raw": "{{base_url}}/api/{{api_version}}/user/auth/login",
                  "host": ["{{base_url}}"],
                  "path": ["api","{{api_version}}","user","auth","login"]
                }
              },
              "response": [
                { "name": "Success 200", "status": "OK", "code": 200, "body": "{ \"success\": true, \"data\": { \"token\": \"abc...\" } }" },
                { "name": "Invalid 401", "status": "Unauthorized", "code": 401, "body": "{ \"success\": false, \"message\": \"Invalid credentials\" }" }
              ],
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test('status is 200', function(){ pm.response.to.have.status(200); });",
                      "var json = pm.response.json();",
                      "pm.test('success true', function(){ pm.expect(json.success).to.eql(true); });",
                      "if (json.data && json.data.token) { pm.environment.set('user_token', json.data.token); }"
                    ],
                    "type": "text/javascript"
                  }
                }
              ]
            },
            {
              "name": "Forgot Password - Send OTP",
              "request": {
                "method": "POST",
                "header": [
                  { "key": "Accept", "value": "application/json" },
                  { "key": "X-Lang", "value": "en" },
                  { "key": "Content-Type", "value": "application/json" }
                ],
                "body": { "mode": "raw", "raw": "{\n  \"phone\": \"+201000000000\"\n}" },
                "url": {
                  "raw": "{{base_url}}/api/{{api_version}}/user/auth/forgot-password/send-otp",
                  "host": ["{{base_url}}"],
                  "path": ["api","{{api_version}}","user","auth","forgot-password","send-otp"]
                }
              },
              "response": [ { "name": "Success 200", "status": "OK", "code": 200, "body": "{ \"success\": true }" } ],
              "event": [ { "listen": "test", "script": { "exec": [ "pm.test('status is 200', function(){ pm.response.to.have.status(200); });", "var json = pm.response.json();", "pm.test('success true', function(){ pm.expect(json.success).to.eql(true); });" ], "type": "text/javascript" } } ]
            },
            {
              "name": "Forgot Password - Verify OTP",
              "request": {
                "method": "POST",
                "header": [
                  { "key": "Accept", "value": "application/json" },
                  { "key": "X-Lang", "value": "en" },
                  { "key": "Content-Type", "value": "application/json" }
                ],
                "body": { "mode": "raw", "raw": "{\n  \"phone\": \"+201000000000\",\n  \"otp\": \"1234\"\n}" },
                "url": {
                  "raw": "{{base_url}}/api/{{api_version}}/user/auth/forgot-password/verify-otp",
                  "host": ["{{base_url}}"],
                  "path": ["api","{{api_version}}","user","auth","forgot-password","verify-otp"]
                }
              },
              "response": [ { "name": "Success 200", "status": "OK", "code": 200, "body": "{ \"success\": true, \"data\": { \"reset_token\": \"r-token\" } }" } ],
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test('status is 200', function(){ pm.response.to.have.status(200); });",
                      "var json = pm.response.json();",
                      "pm.test('success true', function(){ pm.expect(json.success).to.eql(true); });",
                      "if (json.data && json.data.reset_token) { pm.environment.set('reset_token', json.data.reset_token); }"
                    ],
                    "type": "text/javascript"
                  }
                }
              ]
            },
            {
              "name": "Forgot Password - Reset",
              "request": {
                "method": "POST",
                "header": [
                  { "key": "Accept", "value": "application/json" },
                  { "key": "X-Lang", "value": "en" },
                  { "key": "Content-Type", "value": "application/json" }
                ],
                "body": { "mode": "raw", "raw": "{\n  \"phone\": \"+201000000000\",\n  \"reset_token\": \"{{reset_token}}\",\n  \"new_password\": \"NewPassword123!\",\n  \"new_password_confirmation\": \"NewPassword123!\"\n}" },
                "url": {
                  "raw": "{{base_url}}/api/{{api_version}}/user/auth/forgot-password/reset",
                  "host": ["{{base_url}}"],
                  "path": ["api","{{api_version}}","user","auth","forgot-password","reset"]
                }
              },
              "response": [ { "name": "Success 200", "status": "OK", "code": 200, "body": "{ \"success\": true }" } ],
              "event": [ { "listen": "test", "script": { "exec": [ "pm.test('status is 200', function(){ pm.response.to.have.status(200); });", "var json = pm.response.json();", "pm.test('success true', function(){ pm.expect(json.success).to.eql(true); });" ], "type": "text/javascript" } } ]
            },
            {
              "name": "Phone - Send OTP",
              "request": {
                "method": "POST",
                "header": [
                  { "key": "Accept", "value": "application/json" },
                  { "key": "X-Lang", "value": "en" },
                  { "key": "Content-Type", "value": "application/json" }
                ],
                "body": { "mode": "raw", "raw": "{\n  \"phone\": \"{{phone}}\"\n}" },
                "url": {
                  "raw": "{{base_url}}/api/{{api_version}}/user/auth/phone/send-otp",
                  "host": ["{{base_url}}"],
                  "path": ["api","{{api_version}}","user","auth","phone","send-otp"]
                }
              },
              "response": [],
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test('status is 200', function(){ pm.response.to.have.status(200); });",
                      "var json = pm.response.json();",
                      "pm.test('success true', function(){ pm.expect(json.success).to.eql(true); });",
                      "if (json.meta && json.meta.otp_code) { pm.environment.set('otp', json.meta.otp_code); }"
                    ],
                    "type": "text/javascript"
                  }
                }
              ]
            },
            {
              "name": "Phone - Verify OTP",
              "request": {
                "method": "POST",
                "header": [
                  { "key": "Accept", "value": "application/json" },
                  { "key": "X-Lang", "value": "en" },
                  { "key": "Content-Type", "value": "application/json" }
                ],
                "body": { "mode": "raw", "raw": "{\n  \"phone\": \"{{phone}}\",\n  \"otp\": \"{{otp}}\"\n}" },
                "url": {
                  "raw": "{{base_url}}/api/{{api_version}}/user/auth/phone/verify-otp",
                  "host": ["{{base_url}}"],
                  "path": ["api","{{api_version}}","user","auth","phone","verify-otp"]
                }
              },
              "response": [],
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test('status is 200', function(){ pm.response.to.have.status(200); });",
                      "var json = pm.response.json();",
                      "pm.test('success true', function(){ pm.expect(json.success).to.eql(true); });",
                      "pm.test('phone verified', function(){ pm.expect(json.data.user.is_phone_verified).to.eql(true); });",
                      "if (json.data && json.data.user) { pm.environment.set('user_phone_verified', json.data.user.is_phone_verified); }"
                    ],
                    "type": "text/javascript"
                  }
                }
              ]
            }
          ]
        },
        {
          "name": "Protected",
          "description": "Protected auth endpoints that require Bearer token.",
          "auth": { "type": "bearer", "bearer": [ { "key": "token", "value": "{{user_token}}", "type": "string" } ] },
          "item": [
            {
              "name": "Me",
              "request": {
                "method": "GET",
                "header": [
                  { "key": "Accept", "value": "application/json" },
                  { "key": "X-Lang", "value": "en" }
                ],
                "url": {
                  "raw": "{{base_url}}/api/{{api_version}}/user/auth/me",
                  "host": ["{{base_url}}"],
                  "path": ["api","{{api_version}}","user","auth","me"]
                }
              },
              "response": [ { "name": "Success 200", "status": "OK", "code": 200, "body": "{ \"success\": true, \"data\": { \"id\": 1 } }" }, { "name": "Unauthorized 401", "status": "Unauthorized", "code": 401, "body": "{ \"success\": false, \"message\": \"Unauthenticated.\" }" } ],
              "event": [ { "listen": "test", "script": { "exec": [ "pm.test('status is 200', function(){ pm.response.to.have.status(200); });", "var json = pm.response.json();", "pm.test('success true', function(){ pm.expect(json.success).to.eql(true); });" ], "type": "text/javascript" } } ]
            },
            {
              "name": "Logout",
              "request": {
                "method": "POST",
                "header": [
                  { "key": "Accept", "value": "application/json" },
                  { "key": "X-Lang", "value": "en" }
                ],
                "url": {
                  "raw": "{{base_url}}/api/{{api_version}}/user/auth/logout",
                  "host": ["{{base_url}}"],
                  "path": ["api","{{api_version}}","user","auth","logout"]
                }
              },
              "response": [ { "name": "Success 200", "status": "OK", "code": 200, "body": "{ \"success\": true }" } ],
              "event": [ { "listen": "test", "script": { "exec": [ "pm.test('status is 200', function(){ pm.response.to.have.status(200); });", "var json = pm.response.json();", "pm.test('success true', function(){ pm.expect(json.success).to.eql(true); });" ], "type": "text/javascript" } } ]
            }
          ]
        }
      ]
    }
  ]
}
